{"version":3,"file":"config.js","sources":["../../src/client/components/AutoCatalog.ts","../../src/client/config.ts"],"sourcesContent":["import type { VNode } from \"vue\";\nimport { computed, defineComponent, h, shallowRef } from \"vue\";\nimport { useRouter } from \"vue-router\";\nimport { usePageData, useSiteData } from \"vuepress/client\";\nimport {\n  VPLink,\n  endsWith,\n  ensureEndingSlash,\n  ensureLeadingSlash,\n  isNumber,\n  isPlainObject,\n  isString,\n  keys,\n  startsWith,\n  useLocaleConfig,\n} from \"vuepress-shared/client\";\n\nimport type { AutoCatalogLocaleConfig } from \"../../shared/index.js\";\nimport type { AutoCatalogInfo } from \"../helpers/index.js\";\nimport { useAutoCatalogGetter } from \"../helpers/index.js\";\n\nimport \"../styles/auto-catalog.scss\";\n\ndeclare const AUTO_CATALOG_LOCALES: AutoCatalogLocaleConfig;\ndeclare const __VUEPRESS_DEV__: boolean;\n\nexport interface AutoCatalogProps {\n  base?: string;\n  level?: 1 | 2 | 3;\n}\n\ninterface CatalogInfo extends AutoCatalogInfo {\n  level: number;\n  base: string;\n  path: string;\n  children?: CatalogInfo[];\n}\n\nexport default defineComponent({\n  name: \"AutoCatalog\",\n\n  props: {\n    /**\n     * Catalog Base\n     *\n     * 目录的基础路径\n     *\n     * @default current route base\n     */\n    base: {\n      type: String,\n      default: \"\",\n    },\n\n    /**\n     * Max level of catalog\n     *\n     * @description only 1,2,3 are supported\n     *\n     * Catalog 的最大层级\n     *\n     * @description 目前仅支持 1,2,3\n     *\n     * @default 3\n     */\n    level: {\n      type: Number,\n      default: 3,\n    },\n\n    /**\n     * Whether show index for catalog\n     *\n     * 目录是否显示索引\n     */\n    index: Boolean,\n\n    /**\n     * Whether hide `Category` title\n     *\n     * 是否隐藏 `目录` 标题\n     *\n     * @default false\n     */\n    hideHeading: Boolean,\n  },\n\n  setup(props) {\n    // TODO: Remove this in v2 stable\n    // @ts-expect-error\n    // eslint-disable-next-line vue/no-undef-properties\n    if (__VUEPRESS_DEV__ && props.indexType)\n      console.warn(\n        \"[AutoCatalog]: `indexType` is deprecated, please use `index` instead\",\n      );\n\n    const autoCatalogGetter = useAutoCatalogGetter();\n    const locale = useLocaleConfig(AUTO_CATALOG_LOCALES);\n    const page = usePageData();\n    const router = useRouter();\n    const siteData = useSiteData();\n\n    const getCatalogInfo = (): CatalogInfo[] =>\n      router\n        .getRoutes()\n        // filter real page\n        .filter(\n          ({ path }) =>\n            (endsWith(path, \".html\") && !endsWith(path, \"/index.html\")) ||\n            endsWith(path, \"/\"),\n        )\n        .map(({ meta, path }) => {\n          const info = autoCatalogGetter(meta);\n\n          if (!info) return null;\n\n          const level = path.split(\"/\").length;\n\n          return {\n            level: endsWith(path, \"/\") ? level - 2 : level - 1,\n            base: path.replace(/\\/[^/]+\\/?$/, \"/\"),\n            path,\n            ...info,\n          };\n        })\n        .filter(\n          (item): item is CatalogInfo =>\n            isPlainObject(item) && isString(item.title),\n        );\n\n    const catalogInfo = shallowRef(getCatalogInfo());\n\n    const catalogData = computed(() => {\n      const base = props.base\n        ? ensureLeadingSlash(ensureEndingSlash(props.base))\n        : page.value.path.replace(/\\/[^/]+$/, \"/\");\n      const baseDepth = base.split(\"/\").length - 2;\n      const result: CatalogInfo[] = [];\n\n      catalogInfo.value\n        .filter(({ level, path }) => {\n          // filter those under current base\n          if (!startsWith(path, base) || path === base) return false;\n\n          if (base === \"/\") {\n            const otherLocales = keys(siteData.value.locales).filter(\n              (item) => item !== \"/\",\n            );\n\n            // exclude 404 page and other locales\n            if (\n              path === \"/404.html\" ||\n              otherLocales.some((localePath) => startsWith(path, localePath))\n            )\n              return false;\n          }\n\n          return (\n            // level is less than or equal to max level\n            level - baseDepth <= props.level\n          );\n        })\n        .sort(\n          (\n            { title: titleA, level: levelA, order: orderA },\n            { title: titleB, level: levelB, order: orderB },\n          ) => {\n            const level = levelA - levelB;\n\n            if (level) return level;\n\n            // infoA order is absent\n            if (!isNumber(orderA)) {\n              // infoB order is absent\n              if (!isNumber(orderB))\n                // compare title\n                return titleA.localeCompare(titleB);\n\n              // infoB order is present\n              return orderB;\n            }\n\n            // infoB order is absent\n            if (!isNumber(orderB)) return orderA;\n\n            // now we are sure both order exist\n\n            // infoA order is positive\n            if (orderA > 0) {\n              if (orderB > 0) return orderA - orderB;\n\n              return -1;\n            }\n\n            // both order are negative\n            if (orderB < 0) return orderA - orderB;\n\n            return 1;\n          },\n        )\n        .forEach((info) => {\n          const { base, level } = info;\n\n          switch (level - baseDepth) {\n            case 1: {\n              result.push(info);\n              break;\n            }\n\n            case 2: {\n              const parent = result.find((item) => item.path === base);\n\n              if (parent) (parent.children ??= []).push(info);\n              break;\n            }\n\n            default: {\n              const grandParent = result.find(\n                (item) => item.path === base.replace(/\\/[^/]+\\/$/, \"/\"),\n              );\n\n              if (grandParent) {\n                const parent = grandParent.children?.find(\n                  (item) => item.path === base,\n                );\n\n                if (parent) (parent.children ??= []).push(info);\n              }\n            }\n          }\n        });\n\n      return result;\n    });\n\n    return (): VNode => {\n      const isDeep = catalogData.value.some((item) => item.children);\n\n      return h(\n        \"div\",\n        { class: [\"vp-catalog-wrapper\", { index: props.index }] },\n        [\n          props.hideHeading\n            ? null\n            : h(\"h2\", { class: \"vp-catalog-main-title\" }, locale.value.title),\n          catalogData.value.length\n            ? h(\n                props.index ? \"ol\" : \"ul\",\n                { class: [\"vp-catalogs\", { deep: isDeep }] },\n                catalogData.value.map(\n                  ({ children = [], title, path, content }) => {\n                    const childLink = h(\n                      VPLink,\n                      { class: \"vp-catalog-title\", to: path },\n                      () => (content ? h(content) : title),\n                    );\n\n                    return h(\n                      \"li\",\n                      { class: \"vp-catalog\" },\n                      isDeep\n                        ? [\n                            h(\n                              \"h3\",\n                              {\n                                id: title,\n                                class: [\n                                  \"vp-catalog-child-title\",\n                                  { \"has-children\": children.length },\n                                ],\n                              },\n                              [\n                                h(\n                                  \"a\",\n                                  {\n                                    href: `#${title}`,\n                                    class: \"header-anchor\",\n                                    \"aria-hidden\": true,\n                                  },\n                                  \"#\",\n                                ),\n                                childLink,\n                              ],\n                            ),\n                            children.length\n                              ? h(\n                                  props.index ? \"ol\" : \"ul\",\n                                  { class: \"vp-child-catalogs\" },\n                                  children.map(\n                                    ({ children = [], content, path, title }) =>\n                                      h(\"li\", { class: \"vp-child-catalog\" }, [\n                                        h(\n                                          \"div\",\n                                          {\n                                            class: [\n                                              \"vp-catalog-sub-title\",\n                                              {\n                                                \"has-children\": children.length,\n                                              },\n                                            ],\n                                          },\n                                          [\n                                            h(\n                                              \"a\",\n                                              {\n                                                href: `#${title}`,\n                                                class: \"header-anchor\",\n                                              },\n                                              \"#\",\n                                            ),\n                                            h(\n                                              VPLink,\n                                              {\n                                                class: \"vp-catalog-title\",\n                                                to: path,\n                                              },\n                                              () =>\n                                                content ? h(content) : title,\n                                            ),\n                                          ],\n                                        ),\n                                        children.length\n                                          ? h(\n                                              props.index ? \"ol\" : \"div\",\n                                              {\n                                                class: props.index\n                                                  ? \"vp-sub-catalogs\"\n                                                  : \"vp-sub-catalogs-wrapper\",\n                                              },\n                                              children.map(\n                                                ({ content, path, title }) =>\n                                                  props.index\n                                                    ? h(\n                                                        \"li\",\n                                                        {\n                                                          class:\n                                                            \"vp-sub-catalog\",\n                                                        },\n                                                        h(\n                                                          VPLink,\n                                                          { to: path },\n                                                          () =>\n                                                            content\n                                                              ? h(content)\n                                                              : title,\n                                                        ),\n                                                      )\n                                                    : h(\n                                                        VPLink,\n                                                        {\n                                                          class:\n                                                            \"vp-sub-catalog-link\",\n                                                          to: path,\n                                                        },\n                                                        () =>\n                                                          content\n                                                            ? h(content)\n                                                            : title,\n                                                      ),\n                                              ),\n                                            )\n                                          : null,\n                                      ]),\n                                  ),\n                                )\n                              : null,\n                          ]\n                        : h(\n                            \"div\",\n                            { class: \"vp-catalog-child-title\" },\n                            childLink,\n                          ),\n                    );\n                  },\n                ),\n              )\n            : h(\"p\", { class: \"vp-empty-catalog\" }, locale.value.empty),\n        ],\n      );\n    };\n  },\n});\n","import type { ClientConfig } from \"vuepress/client\";\nimport { defineClientConfig } from \"vuepress/client\";\nimport { hasGlobalComponent } from \"vuepress-shared/client\";\n\nimport AutoCatalog from \"./components/AutoCatalog.js\";\nimport { injectAutoCatalogGetter } from \"./helpers/index.js\";\n\n// eslint-disable-next-line @typescript-eslint/no-unnecessary-type-assertion\nexport default <ClientConfig>defineClientConfig({\n  enhance: ({ app }) => {\n    injectAutoCatalogGetter(app);\n    if (!hasGlobalComponent(\"AutoCatalog\", app))\n      app.component(\"AutoCatalog\", AutoCatalog);\n  },\n});\n"],"names":["i","defineComponent","props","autoCatalogGetter","useAutoCatalogGetter","locale","useLocaleConfig","page","usePageData","router","useRouter","siteData","useSiteData","catalogInfo","shallowRef","path","endsWith","meta","info","level","item","isPlainObject","isString","catalogData","computed","base","ensureLeadingSlash","ensureEndingSlash","baseDepth","result","startsWith","otherLocales","keys","localePath","titleA","levelA","orderA","titleB","levelB","orderB","isNumber","parent","grandParent","isDeep","h","children","title","content","childLink","VPLink","config","defineClientConfig","app","injectAutoCatalogGetter","hasGlobalComponent","AutoCatalog"],"mappings":"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"}