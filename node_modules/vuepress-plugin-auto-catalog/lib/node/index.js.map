{"version":3,"file":"index.js","sources":["../../src/node/utils.ts","../../src/node/autoCatalog.ts","../../src/node/compact.ts","../../src/node/locales.ts","../../src/node/plugin.ts"],"sourcesContent":["import { getDirname, path } from \"vuepress/utils\";\nimport { Logger, ensureEndingSlash } from \"vuepress-shared/node\";\n\nconst __dirname = getDirname(import.meta.url);\n\nexport const PLUGIN_NAME = \"vuepress-plugin-auto-catalog\";\n\nexport const logger = new Logger(PLUGIN_NAME);\n\nexport const CLIENT_FOLDER = ensureEndingSlash(\n  path.resolve(__dirname, \"../client\"),\n);\n","import type { App } from \"vuepress/core\";\nimport { createPage } from \"vuepress/core\";\nimport type { PageFrontmatter } from \"vuepress/shared\";\nimport { getTitleFromFilename } from \"vuepress-shared/node\";\n\nimport type { AutoCatalogOptions } from \"./options.js\";\nimport { logger } from \"./utils.js\";\n\nexport const generateCatalog = async (\n  app: App,\n  {\n    component = \"AutoCatalog\",\n    exclude = [],\n    frontmatter = (): PageFrontmatter => ({}),\n    level = 3,\n    index = false,\n  }: AutoCatalogOptions,\n): Promise<void> => {\n  const {\n    env: { isDebug },\n    pages,\n  } = app;\n\n  const pathToBeGenerated = new Set<string>();\n  const content = `\\\n<${component}${[1, 2].includes(level) ? ` :level=\"${level}\"` : \"\"}${\n    index ? \" index\" : \"\"\n  }/>\n`;\n\n  pages.forEach(({ path: pagePath, pathLocale }) => {\n    let catalogPath = pagePath;\n\n    // not 404 page\n    if (pagePath !== \"/404.html\")\n      while (catalogPath !== pathLocale) {\n        catalogPath = catalogPath.replace(/\\/(?:[^/]+\\/?)$/, \"/\");\n\n        if (\n          // not discovered yet\n          !pathToBeGenerated.has(catalogPath) &&\n          // not being excluded\n          exclude.every((pattern) => !catalogPath.match(pattern)) &&\n          // path not found\n          pages.every(({ path }) => path !== catalogPath)\n        ) {\n          if (isDebug) logger.info(`Generating catalog ${catalogPath}`);\n\n          pathToBeGenerated.add(catalogPath);\n        }\n      }\n  });\n\n  await Promise.all(\n    Array.from(pathToBeGenerated)\n      .map((path) => decodeURI(path))\n      .map((path) => {\n        const [, basename = \"\"] = /\\/([^/]+)\\/?$/.exec(path) || [];\n        const title = getTitleFromFilename(basename);\n\n        return createPage(app, {\n          frontmatter: {\n            title,\n            ...(frontmatter(path) || {}),\n          },\n          content,\n          path,\n        });\n      }),\n  ).then((pages) => {\n    app.pages.push(...pages);\n  });\n};\n","import { colors } from \"vuepress/utils\";\nimport { createConverter } from \"vuepress-shared/node\";\n\nimport type { AutoCatalogOptions } from \"./options.js\";\n\n/** @deprecated */\nexport const convertOptions = (\n  options: AutoCatalogOptions & Record<string, unknown>,\n): void => {\n  const { deprecatedLogger, droppedLogger } = createConverter(\"auto-catalog\");\n\n  deprecatedLogger({\n    options,\n    old: \"getTitle\",\n    new: \"titleGetter\",\n  });\n  deprecatedLogger({\n    options,\n    old: \"getIcon\",\n    new: \"iconGetter\",\n  });\n  deprecatedLogger({\n    options,\n    old: \"getOrder\",\n    new: \"orderGetter\",\n  });\n  deprecatedLogger({\n    options,\n    old: \"getIndex\",\n    new: \"shouldIndex\",\n  });\n\n  droppedLogger({\n    options,\n    old: \"iconComponent\",\n    msg: `please use ${colors.magenta(\n      \"defineAutoCatalogIconComponent\",\n    )} in client config file.`,\n  });\n};\n","import type { AutoCatalogLocaleConfig } from \"../shared/index.js\";\n\nexport const locales: AutoCatalogLocaleConfig = {\n  \"/en/\": {\n    title: \"Catalog\",\n    empty: \"No catalog\",\n  },\n\n  \"/zh/\": {\n    title: \"目录\",\n    empty: \"暂无目录\",\n  },\n\n  \"/zh-tw/\": {\n    title: \"目錄\",\n    empty: \"暫無目錄\",\n  },\n\n  \"/de/\": {\n    title: \"Katalog\",\n    empty: \"Kein Katalog\",\n  },\n\n  \"/de-at/\": {\n    title: \"Katalog\",\n    empty: \"Kein Katalog\",\n  },\n\n  \"/vi/\": {\n    title: \"Danh mục\",\n    empty: \"Không có danh mục\",\n  },\n\n  \"/uk/\": {\n    title: \"Каталог\",\n    empty: \"Немає каталогу\",\n  },\n\n  \"/ru/\": {\n    title: \"Каталог\",\n    empty: \"Нет каталога\",\n  },\n\n  \"/br/\": {\n    title: \"Catálogo\",\n    empty: \"Sem catálogo\",\n  },\n\n  \"/pl/\": {\n    title: \"Katalog\",\n    empty: \"Brak katalogu\",\n  },\n\n  \"/sk/\": {\n    title: \"Katalóg\",\n    empty: \"Žiadny katalóg\",\n  },\n\n  \"/fr/\": {\n    title: \"Catalogue\",\n    empty: \"Pas de catalogue\",\n  },\n\n  \"/es/\": {\n    title: \"Catálogo\",\n    empty: \"Sin catálogo\",\n  },\n\n  \"/ja/\": {\n    title: \"カタログ\",\n    empty: \"カタログなし\",\n  },\n\n  \"/tr/\": {\n    title: \"Katalog\",\n    empty: \"Katalog yok\",\n  },\n\n  \"/ko/\": {\n    title: \"목차\",\n    empty: \"목차 없음\",\n  },\n\n  \"/fi/\": {\n    title: \"Luettelo\",\n    empty: \"Ei luetteloa\",\n  },\n\n  \"/hu/\": {\n    title: \"Katalógus\",\n    empty: \"Nincs katalógus\",\n  },\n\n  \"/id/\": {\n    title: \"Katalog\",\n    empty: \"Tidak ada katalog\",\n  },\n\n  \"/nl/\": {\n    title: \"Catalogus\",\n    empty: \"Geen catalogus\",\n  },\n};\n","import type { PluginFunction } from \"vuepress/core\";\nimport { useSassPalettePlugin } from \"vuepress-plugin-sass-palette\";\nimport { addViteSsrNoExternal, getLocales } from \"vuepress-shared/node\";\n\nimport { generateCatalog } from \"./autoCatalog.js\";\nimport { convertOptions } from \"./compact.js\";\nimport { locales as defaultLocales } from \"./locales.js\";\nimport type { AutoCatalogOptions } from \"./options.js\";\nimport { CLIENT_FOLDER, PLUGIN_NAME, logger } from \"./utils.js\";\n\nexport const autoCatalogPlugin =\n  (options: AutoCatalogOptions = {}, legacy = true): PluginFunction =>\n  (app) => {\n    if (legacy)\n      convertOptions(options as AutoCatalogOptions & Record<string, unknown>);\n\n    if (app.env.isDebug) logger.info(\"Options:\", options);\n\n    useSassPalettePlugin(app, { id: \"hope\" });\n\n    const { component, locales } = options;\n\n    return {\n      name: PLUGIN_NAME,\n\n      define: (): Record<string, unknown> => ({\n        AUTO_CATALOG_LOCALES: getLocales({\n          app,\n          name: PLUGIN_NAME,\n          default: defaultLocales,\n          config: locales,\n        }),\n      }),\n\n      onInitialized: (app): Promise<void> => generateCatalog(app, options),\n\n      extendsBundlerOptions: (bundlerOptions: unknown, app): void => {\n        addViteSsrNoExternal(bundlerOptions, app, \"vuepress-shared\");\n      },\n\n      ...(component ? {} : { clientConfigFile: `${CLIENT_FOLDER}config.js` }),\n    };\n  };\n"],"names":["__dirname","getDirname","PLUGIN_NAME","logger","Logger","CLIENT_FOLDER","ensureEndingSlash","path","generateCatalog","app","component","exclude","frontmatter","level","index","isDebug","pages","pathToBeGenerated","content","pagePath","pathLocale","catalogPath","pattern","basename","title","getTitleFromFilename","createPage","convertOptions","options","deprecatedLogger","droppedLogger","createConverter","colors","locales","autoCatalogPlugin","legacy","useSassPalettePlugin","getLocales","defaultLocales","bundlerOptions","addViteSsrNoExternal"],"mappings":"+UAGA,MAAMA,EAAYC,EAAW,YAAY,GAAG,EAE/BC,EAAc,+BAEdC,EAAS,IAAIC,EAAOF,CAAW,EAE/BG,EAAgBC,EAC3BC,EAAK,QAAQP,EAAW,WAAW,CACrC,ECHaQ,EAAkB,MAC7BC,EACA,CACE,UAAAC,EAAY,cACZ,QAAAC,EAAU,GACV,YAAAC,EAAc,KAAwB,IACtC,MAAAC,EAAQ,EACR,MAAAC,EAAQ,EACV,IACkB,CAClB,KAAM,CACJ,IAAK,CAAE,QAAAC,CAAQ,EACf,MAAAC,CACF,EAAIP,EAEEQ,EAAoB,IAAI,IACxBC,EAAU,IACfR,CAAS,GAAG,CAAC,EAAG,CAAC,EAAE,SAASG,CAAK,EAAI,YAAYA,CAAK,IAAM,EAAE,GAC7DC,EAAQ,SAAW,EACrB;AAAA,EAGAE,EAAM,QAAQ,CAAC,CAAE,KAAMG,EAAU,WAAAC,CAAW,IAAM,CAChD,IAAIC,EAAcF,EAGlB,GAAIA,IAAa,YACf,KAAOE,IAAgBD,GACrBC,EAAcA,EAAY,QAAQ,kBAAmB,GAAG,EAItD,CAACJ,EAAkB,IAAII,CAAW,GAElCV,EAAQ,MAAOW,GAAY,CAACD,EAAY,MAAMC,CAAO,CAAC,GAEtDN,EAAM,MAAM,CAAC,CAAE,KAAAT,CAAK,IAAMA,IAASc,CAAW,IAE1CN,GAASZ,EAAO,KAAK,sBAAsBkB,CAAW,EAAE,EAE5DJ,EAAkB,IAAII,CAAW,EAGzC,CAAC,EAED,MAAM,QAAQ,IACZ,MAAM,KAAKJ,CAAiB,EACzB,IAAKV,GAAS,UAAUA,CAAI,CAAC,EAC7B,IAAKA,GAAS,CACb,KAAM,CAAA,CAAGgB,EAAW,EAAE,EAAI,gBAAgB,KAAKhB,CAAI,GAAK,CAAC,EACnDiB,EAAQC,EAAqBF,CAAQ,EAE3C,OAAOG,EAAWjB,EAAK,CACrB,YAAa,CACX,MAAAe,EACA,GAAIZ,EAAYL,CAAI,GAAK,EAC3B,EACA,QAAAW,EACA,KAAAX,CACF,CAAC,CACH,CAAC,CACL,EAAE,KAAMS,GAAU,CAChBP,EAAI,MAAM,KAAK,GAAGO,CAAK,CACzB,CAAC,CACH,EClEaW,EACXC,GACS,CACT,KAAM,CAAE,iBAAAC,EAAkB,cAAAC,CAAc,EAAIC,EAAgB,cAAc,EAE1EF,EAAiB,CACf,QAAAD,EACA,IAAK,WACL,IAAK,aACP,CAAC,EACDC,EAAiB,CACf,QAAAD,EACA,IAAK,UACL,IAAK,YACP,CAAC,EACDC,EAAiB,CACf,QAAAD,EACA,IAAK,WACL,IAAK,aACP,CAAC,EACDC,EAAiB,CACf,QAAAD,EACA,IAAK,WACL,IAAK,aACP,CAAC,EAEDE,EAAc,CACZ,QAAAF,EACA,IAAK,gBACL,IAAK,cAAcI,EAAO,QACxB,gCACF,CAAC,yBACH,CAAC,CACH,ECrCaC,EAAmC,CAC9C,OAAQ,CACN,MAAO,UACP,MAAO,YACT,EAEA,OAAQ,CACN,MAAO,KACP,MAAO,MACT,EAEA,UAAW,CACT,MAAO,KACP,MAAO,MACT,EAEA,OAAQ,CACN,MAAO,UACP,MAAO,cACT,EAEA,UAAW,CACT,MAAO,UACP,MAAO,cACT,EAEA,OAAQ,CACN,MAAO,WACP,MAAO,mBACT,EAEA,OAAQ,CACN,MAAO,UACP,MAAO,gBACT,EAEA,OAAQ,CACN,MAAO,UACP,MAAO,cACT,EAEA,OAAQ,CACN,MAAO,WACP,MAAO,cACT,EAEA,OAAQ,CACN,MAAO,UACP,MAAO,eACT,EAEA,OAAQ,CACN,MAAO,UACP,MAAO,gBACT,EAEA,OAAQ,CACN,MAAO,YACP,MAAO,kBACT,EAEA,OAAQ,CACN,MAAO,WACP,MAAO,cACT,EAEA,OAAQ,CACN,MAAO,OACP,MAAO,QACT,EAEA,OAAQ,CACN,MAAO,UACP,MAAO,aACT,EAEA,OAAQ,CACN,MAAO,KACP,MAAO,OACT,EAEA,OAAQ,CACN,MAAO,WACP,MAAO,cACT,EAEA,OAAQ,CACN,MAAO,YACP,MAAO,iBACT,EAEA,OAAQ,CACN,MAAO,UACP,MAAO,mBACT,EAEA,OAAQ,CACN,MAAO,YACP,MAAO,gBACT,CACF,EC5FaC,EACX,CAACN,EAA8B,CAAIO,EAAAA,EAAS,KAC3C1B,GAAQ,CACH0B,GACFR,EAAeC,CAAuD,EAEpEnB,EAAI,IAAI,SAASN,EAAO,KAAK,WAAYyB,CAAO,EAEpDQ,EAAqB3B,EAAK,CAAE,GAAI,MAAO,CAAC,EAExC,KAAM,CAAE,UAAAC,EAAW,QAAAuB,CAAQ,EAAIL,EAE/B,MAAO,CACL,KAAM1B,EAEN,OAAQ,KAAgC,CACtC,qBAAsBmC,EAAW,CAC/B,IAAA5B,EACA,KAAMP,EACN,QAASoC,EACT,OAAQL,CACV,CAAC,CACH,GAEA,cAAgBxB,GAAuBD,EAAgBC,EAAKmB,CAAO,EAEnE,sBAAuB,CAACW,EAAyB9B,IAAc,CAC7D+B,EAAqBD,EAAgB9B,EAAK,iBAAiB,CAC7D,EAEA,GAAIC,EAAY,CAAC,EAAI,CAAE,iBAAkB,GAAGL,CAAa,WAAY,CACvE,CACF"}