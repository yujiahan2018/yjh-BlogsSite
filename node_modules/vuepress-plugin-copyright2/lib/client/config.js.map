{"version":3,"file":"config.js","sources":["../../src/client/composables/setup.ts","../../src/client/config.ts"],"sourcesContent":["import { useEventListener } from \"@vueuse/core\";\nimport { computed, onMounted, watchEffect } from \"vue\";\nimport { usePageData, usePageFrontmatter } from \"vuepress/client\";\nimport type { RequiredLocaleConfig } from \"vuepress-shared/client\";\nimport {\n  isLinkHttp,\n  isPlainObject,\n  isString,\n  removeEndingSlash,\n  useLocaleConfig,\n} from \"vuepress-shared/client\";\n\nimport type {\n  CopyrightLocaleData,\n  CopyrightPluginFrontmatter,\n  CopyrightPluginPageData,\n} from \"../../shared/index.js\";\n\ndeclare const COPYRIGHT_CANONICAL: string;\ndeclare const COPYRIGHT_DISABLE_COPY: boolean;\ndeclare const COPYRIGHT_DISABLE_SELECTION: boolean;\ndeclare const COPYRIGHT_GLOBAL: boolean;\ndeclare const COPYRIGHT_DEFAULT_AUTHOR: string;\ndeclare const COPYRIGHT_DEFAULT_LICENSE: string;\ndeclare const COPYRIGHT_LOCALES: RequiredLocaleConfig<CopyrightLocaleData>;\ndeclare const COPYRIGHT_MAX_LENGTH: number;\ndeclare const COPYRIGHT_TRIGGER_LENGTH: number;\n\nconst canonical = COPYRIGHT_CANONICAL;\n\nexport const setupCopyright = (): void => {\n  const frontmatter = usePageFrontmatter<CopyrightPluginFrontmatter>();\n  const locale = useLocaleConfig(COPYRIGHT_LOCALES);\n  const page = usePageData<CopyrightPluginPageData>();\n\n  const enabled = computed(\n    () =>\n      Boolean(frontmatter.value.copy) ||\n      (frontmatter.value.copy !== false && COPYRIGHT_GLOBAL),\n  );\n\n  const copyOptions = computed(() =>\n    isPlainObject(frontmatter.value.copy) ? frontmatter.value.copy : null,\n  );\n\n  const disableCopy = computed(\n    () => copyOptions.value?.disableCopy ?? COPYRIGHT_DISABLE_COPY,\n  );\n\n  const disableSelection = computed(() =>\n    enabled.value\n      ? copyOptions.value?.disableSelection ?? COPYRIGHT_DISABLE_SELECTION\n      : false,\n  );\n\n  const maxLength = computed(() =>\n    enabled.value ? copyOptions.value?.maxLength ?? COPYRIGHT_MAX_LENGTH : 0,\n  );\n\n  const triggerLength = computed(\n    () => copyOptions.value?.triggerLength ?? COPYRIGHT_TRIGGER_LENGTH,\n  );\n\n  const getLink = (): string =>\n    canonical\n      ? `${removeEndingSlash(\n          isLinkHttp(canonical) ? canonical : `https://${canonical}`,\n        )}${page.value.path}`\n      : window.location.href;\n\n  const getCopyrightContent = (\n    authorInfo: string,\n    licenseInfo: string,\n  ): string => {\n    const { author, license, link } = locale.value;\n\n    return [\n      authorInfo ? author.replace(\":author\", authorInfo) : \"\",\n      licenseInfo ? license.replace(\":license\", licenseInfo) : \"\",\n      link.replace(\":link\", getLink()),\n    ]\n      .filter((item) => item)\n      .join(\"\\n\");\n  };\n\n  const getCopyright = (): string => {\n    if (isString(page.value.copyright))\n      return page.value.copyright.replace(\":link\", getLink());\n\n    const { author, license } = page.value.copyright || {};\n\n    return getCopyrightContent(\n      author ?? COPYRIGHT_DEFAULT_AUTHOR,\n      license ?? COPYRIGHT_DEFAULT_LICENSE,\n    );\n  };\n\n  const onCopy = (event: ClipboardEvent): void => {\n    const selection = getSelection();\n\n    if (selection) {\n      const textRange = selection.getRangeAt(0);\n\n      if (enabled.value) {\n        const textLength = textRange.toString().length;\n\n        if (\n          disableCopy.value ||\n          (maxLength.value && textLength > maxLength.value)\n        )\n          return event.preventDefault();\n\n        if (textLength >= triggerLength.value) {\n          event.preventDefault();\n\n          const copyright = getCopyright();\n          const node = document.createElement(\"div\");\n\n          node.appendChild(selection.getRangeAt(0).cloneContents());\n\n          if (event.clipboardData) {\n            event.clipboardData.setData(\n              \"text/html\",\n              `${node.innerHTML}<hr><div class=\"copyright\">${copyright.replace(\n                /\\\\n/g,\n                \"<br>\",\n              )}</div>`,\n            );\n            event.clipboardData.setData(\n              \"text/plain\",\n              `${\n                selection.getRangeAt(0).cloneContents().textContent || \"\"\n              }\\n------\\n${copyright}`,\n            );\n          }\n        }\n      }\n    }\n  };\n\n  onMounted(() => {\n    const appElement = document.querySelector<HTMLDivElement>(\"#app\")!;\n\n    useEventListener(appElement, \"copy\", onCopy);\n\n    watchEffect(() => {\n      appElement.style.userSelect = disableSelection.value ? \"none\" : \"auto\";\n    });\n  });\n};\n","import type { ClientConfig } from \"vuepress/client\";\nimport { defineClientConfig } from \"vuepress/client\";\n\nimport { setupCopyright } from \"./composables/index.js\";\n\n// eslint-disable-next-line @typescript-eslint/no-unnecessary-type-assertion\nexport default <ClientConfig>defineClientConfig({\n  setup: () => {\n    setupCopyright();\n  },\n});\n"],"names":["canonical","setupCopyright","frontmatter","usePageFrontmatter","locale","useLocaleConfig","page","usePageData","enabled","computed","copyOptions","isPlainObject","disableCopy","disableSelection","maxLength","triggerLength","getLink","removeEndingSlash","isLinkHttp","getCopyrightContent","authorInfo","licenseInfo","author","license","link","item","getCopyright","isString","onCopy","event","selection","textRange","textLength","copyright","node","onMounted","appElement","useEventListener","watchEffect","defineClientConfig"],"mappings":"8UA4BA,MAAMA,EAAY,oBAELC,EAAiB,IAAY,CACxC,MAAMC,EAAcC,EAAAA,EACdC,EAASC,EAAgB,iBAAiB,EAC1CC,EAAOC,EAAqC,EAE5CC,EAAUC,EACd,IACE,EAAQP,EAAY,MAAM,MACzBA,EAAY,MAAM,OAAS,IAAS,gBACzC,EAEMQ,EAAcD,EAAS,IAC3BE,EAAcT,EAAY,MAAM,IAAI,EAAIA,EAAY,MAAM,KAAO,IACnE,EAEMU,EAAcH,EAClB,IAAMC,EAAY,OAAO,aAAe,sBAC1C,EAEMG,EAAmBJ,EAAS,IAChCD,EAAQ,MACJE,EAAY,OAAO,kBAAoB,4BACvC,EACN,EAEMI,EAAYL,EAAS,IACzBD,EAAQ,MAAQE,EAAY,OAAO,WAAa,qBAAuB,CACzE,EAEMK,EAAgBN,EACpB,IAAMC,EAAY,OAAO,eAAiB,wBAC5C,EAEMM,EAAU,IACdhB,EACI,GAAGiB,EACDC,EAAWlB,CAAS,EAAIA,EAAY,WAAWA,CAAS,EAC1D,CAAC,GAAGM,EAAK,MAAM,IAAI,GACnB,OAAO,SAAS,KAEhBa,EAAsB,CAC1BC,EACAC,IACW,CACX,KAAM,CAAE,OAAAC,EAAQ,QAAAC,EAAS,KAAAC,CAAK,EAAIpB,EAAO,MAEzC,MAAO,CACLgB,EAAaE,EAAO,QAAQ,UAAWF,CAAU,EAAI,GACrDC,EAAcE,EAAQ,QAAQ,WAAYF,CAAW,EAAI,GACzDG,EAAK,QAAQ,QAASR,EAAS,CAAA,CACjC,EACG,OAAQS,GAASA,CAAI,EACrB,KAAK;AAAA,CAAI,CACd,EAEMC,EAAe,IAAc,CACjC,GAAIC,EAASrB,EAAK,MAAM,SAAS,EAC/B,OAAOA,EAAK,MAAM,UAAU,QAAQ,QAASU,EAAS,CAAA,EAExD,KAAM,CAAE,OAAAM,EAAQ,QAAAC,CAAQ,EAAIjB,EAAK,MAAM,WAAa,CAAC,EAErD,OAAOa,EACLG,GAAU,yBACVC,GAAW,yBACb,CACF,EAEMK,EAAUC,GAAgC,CAC9C,MAAMC,EAAY,aAAA,EAElB,GAAIA,EAAW,CACb,MAAMC,EAAYD,EAAU,WAAW,CAAC,EAExC,GAAItB,EAAQ,MAAO,CACjB,MAAMwB,EAAaD,EAAU,WAAW,OAExC,GACEnB,EAAY,OACXE,EAAU,OAASkB,EAAalB,EAAU,MAE3C,OAAOe,EAAM,eAAe,EAE9B,GAAIG,GAAcjB,EAAc,MAAO,CACrCc,EAAM,eAAA,EAEN,MAAMI,EAAYP,EACZQ,EAAAA,EAAO,SAAS,cAAc,KAAK,EAEzCA,EAAK,YAAYJ,EAAU,WAAW,CAAC,EAAE,cAAA,CAAe,EAEpDD,EAAM,gBACRA,EAAM,cAAc,QAClB,YACA,GAAGK,EAAK,SAAS,8BAA8BD,EAAU,QACvD,OACA,MACF,CAAC,QACH,EACAJ,EAAM,cAAc,QAClB,aACA,GACEC,EAAU,WAAW,CAAC,EAAE,cAAc,EAAE,aAAe,EACzD;AAAA;AAAA,EAAaG,CAAS,EACxB,EAEJ,CACF,CACF,CACF,EAEAE,EAAU,IAAM,CACd,MAAMC,EAAa,SAAS,cAA8B,MAAM,EAEhEC,EAAiBD,EAAY,OAAQR,CAAM,EAE3CU,EAAY,IAAM,CAChBF,EAAW,MAAM,WAAavB,EAAiB,MAAQ,OAAS,MAClE,CAAC,CACH,CAAC,CACH,EC/IA,IAA6B0B,EAAAA,EAAmB,CAC9C,MAAO,IAAM,CACXtC,EAAe,CACjB,CACF,CAAC"}